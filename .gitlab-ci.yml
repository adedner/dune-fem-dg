---
variables:
  DUNECI_OPTS: "/builds/dune-fem/dune-fem/scripts/opts/ci-gcc.opts"

before_script:
#  - rm -rf /duneci/modules/dune-alugrid
  - duneci-install-module https://gitlab.dune-project.org/extensions/dune-alugrid.git
  - duneci-install-module https://gitlab.dune-project.org/extensions/dune-spgrid.git

.base: &base
  stage: test
  when: always
  tags:
    - "stuttgart"

# FEM_REQUIRE_PETSC=force is intended to trigger an error during cmake
# configuration if PETSc is not found
.base-petsc: &base-petsc
  <<: *base
  variables:
    FEM_REQUIRE_PETSC: "force"

# available image tags,
# debian-9-gcc-6-14
# debian-10-gcc-7-14
# debian-10-gcc-8-17
# debian-10-gcc-8-noassert-17
# debian-10-clang-6-libcpp-17 <-- this one does not seem to work
# ubuntu-18.04-clang-6-17
#
# We reserve some jobs for the nightly build. The Gitlab-schedule for
# the nightly build will also set the environment variable
# TORTURE_TESTS=on

#debian-10-gcc-7-14:
#  <<: *base-petsc
#  image: dune-fem-ci:git-debian-10-gcc-7-14
#  script: duneci-standard-test --opts=/builds/dune-fem/dune-fem/scripts/opts/ci-gcc7.opts

debian-10-gcc-8-17:
  <<: *base-petsc
  image: dune-fem-ci:git-debian-10-gcc-8-17
  script: duneci-standard-test --opts=/builds/dune-fem-dg/dune-fem/scripts/opts/ci-gcc.opts
  only:
    - triggers
    - schedules

ubuntu-18.04-clang-6-17:
  <<: *base-petsc
  image: dune-fem-ci:git-ubuntu-18.04-clang-6-17
  script: duneci-standard-test --opts=/builds/dune-fem-dg/dune-fem/scripts/opts/ci-clang.opts
